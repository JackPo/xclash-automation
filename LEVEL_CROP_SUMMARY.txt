================================================================================
                    LEVEL NUMBER CROP ANALYSIS SUMMARY
================================================================================

EXAMINATION: 5 level number crops from level_crops/
CROP METHOD: frame[cy+35:cy+60, cx-25:cx+25] (50px wide x 25px tall)
DATE: 2025-11-05

================================================================================
                              QUICK RESULTS
================================================================================

  Level  |  File Name              | Width  | Height | Complete? | Comment
---------|-------------------------|--------|--------|-----------|------------------
    0    | level_00_center_531_... | 50px   | 25px   |    YES    | Full capture
    1    | level_01_center_91_...  | 50px   | 25px   |    YES    | Full capture
    2    | level_02_center_1982... | 50px   | 25px   |    YES    | Full capture
    3    | level_03_center_1422... | 50px   | 25px   |    YES    | Full capture
    4    | level_04_center_87_...  | 50px   | 11px   |    NO     | Truncated!

================================================================================
                         SPACE REQUIREMENTS MATRIX
================================================================================

                        TOP         BOTTOM      LEFT      RIGHT
Current Formula:      cy+35       cy+60       cx-25     cx+25
Current Pixels:        14px        26px        25px      25px

Level 0:              SUFFICIENT  SUFFICIENT  SUFFICIENT SUFFICIENT
Level 1:              SUFFICIENT  SUFFICIENT  SUFFICIENT SUFFICIENT
Level 2:              SUFFICIENT  SUFFICIENT  SUFFICIENT SUFFICIENT
Level 3:              SUFFICIENT  SUFFICIENT  SUFFICIENT SUFFICIENT
Level 4:              MINIMUM     INSUFFICIENT SUFFICIENT SUFFICIENT

PROBLEM DETAILS FOR LEVEL 4:
  - Currently captures: 11px tall (not 25px)
  - Missing at bottom: 14px (the entire bottom of the level bar is cut off)
  - Missing at top: Not needed, but could add for symmetry
  - Root cause: The level bar at that location extends below row 1440
  - Current bottom boundary: cy+60 = 1394+60 = 1454 (exceeds image bounds)

================================================================================
                           RECOMMENDED ADJUSTMENT
================================================================================

CHANGE FROM:
  frame[cy+35:cy+60, cx-25:cx+25]
  
  Breakdown:
    Top offset:    +35 pixels below center
    Bottom offset: +60 pixels below center
    Height:        25 pixels (60-35=25)
    Width:         50 pixels (25+25=50)

TO:
  frame[cy+25:cy+75, cx-25:cx+25]
  
  Breakdown:
    Top offset:    +25 pixels below center
    Bottom offset: +75 pixels below center
    Height:        50 pixels (75-25=50)
    Width:         50 pixels (25+25=50)

CHANGES:
  ✓ Move top from cy+35 to cy+25 (shift UP by 10 pixels)
  ✓ Move bottom from cy+60 to cy+75 (shift DOWN by 15 pixels)
  ✓ Total height: 25px → 50px (increase by 25 pixels)

================================================================================
                            VISUAL REPRESENTATION
================================================================================

LEVEL 0-3 (Working Fine):
┌────────────────────────────────────┐
│ Requested: frame[cy+35:cy+60, ...]│
│ Result:    Captures full 25px      │
│            No issues               │
└────────────────────────────────────┘

LEVEL 4 (Problem):
┌────────────────────────────────────┐
│ Requested: frame[cy+35:cy+60, ...]│
│ Result:    Only 11px captured      │
│ Missing:   14px at the BOTTOM      │
│                                    │
│ ┌──────────────────────────────┐   │
│ │ [Captured: 11px]             │   │
│ │ [MISSING: 14px] ← LEVEL BAR! │   │
│ │ [OUT OF BOUNDS: 1454+]       │   │
│ └──────────────────────────────┘   │
└────────────────────────────────────┘

SOLUTION (New Formula):
┌────────────────────────────────────┐
│ Requested: frame[cy+25:cy+75, ...]│
│ Result:    Captures full 50px      │
│                                    │
│ ┌──────────────────────────────┐   │
│ │ [Extra: 10px]                │   │
│ │ [Captured: 25px]             │   │
│ │ [Captured: 25px]             │   │
│ │ [Extra: 10px]                │   │
│ └──────────────────────────────┘   │
│ All levels now capture safely!    │
└────────────────────────────────────┘

================================================================================
                             PIXEL BREAKDOWN
================================================================================

LEVEL 04 ANALYSIS (The problematic one):

Center coordinates: (87, 1394)

Current extraction:
  Top row:    cy+35  = 1394+35  = 1429
  Bottom row: cy+60  = 1394+60  = 1454
  Height:     1454-1429 = 25 pixels requested
  
  Actual result: Only 11 pixels available
  Reason: Row 1454 exceeds image bounds (max is ~1440)
  Missing: Rows 1440-1454 (14 pixels with level bar content)

Recommended extraction:
  Top row:    cy+25  = 1394+25  = 1419
  Bottom row: cy+75  = 1394+75  = 1469
  Height:     1469-1419 = 50 pixels requested
  
  Result: Safe capture with buffer
  If bounds hit at 1440, still get rows 1419-1440
  Leaves room for level bar growth/variation

================================================================================
                            IMPLEMENTATION STEPS
================================================================================

1. Locate your crop extraction code (likely in level detection script)

2. Find the line: frame[cy+35:cy+60, cx-25:cx+25]

3. Replace with: frame[cy+25:cy+75, cx-25:cx+25]

4. Test:
   - Re-run on existing level crops
   - Levels 0-3: Should work same as before (extra space ignored)
   - Level 4: Should now show full 50px (was 11px)

5. Update your OCR/detection pipeline if it assumes 25px height
   - It will now receive 50px
   - Add scaling if needed

6. Consider all castles detected use the new formula going forward

================================================================================
                                  FILES GENERATED
================================================================================

1. LEVEL_CROP_ANALYSIS_REPORT.md
   → Detailed markdown report with all findings

2. CROP_ADJUSTMENT_GUIDE.txt
   → Implementation guide with checklists

3. LEVEL_CROP_SUMMARY.txt (this file)
   → Quick reference summary

4. all_crops_comparison.png
   → Visual grid of all 5 crops with status

5. vis_level_*.png (5 files)
   → Individual visualizations of current vs recommended crop areas
   → Colors: Blue=current, Green=recommended, Red=missing

================================================================================
                                    CONCLUSION
================================================================================

The issue is REAL but FIXABLE:
  ✗ Current formula is too restrictive at the bottom
  ✓ New formula provides sufficient buffer for all cases
  ✓ Backward compatible (extra space is harmless)
  ✓ One-line code change needed

Recommended action: Update crop formula in your level detection code
  FROM: frame[cy+35:cy+60, cx-25:cx+25]
  TO:   frame[cy+25:cy+75, cx-25:cx+25]

This will ensure all level bars are captured completely and reliably.

================================================================================
